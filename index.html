<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SiteCraftAI — Build a site in ~60s</title>
<meta name="description" content="Describe your website. SiteCraftAI builds it in ~60 seconds. Preview, tweak, and publish live." />
<style>
  :root{
    --ink:#0b1220;
    --muted:#94a3b8;
    --panel:#0e1627;
    --panel-2:#0c1423;
    --edge:#17243a;
    --brand1:#12d4cf;     /* turquoise accent */
    --brand2:#0ea5e9;     /* blue accent */
    --accent:#ffd84d;     /* soft metallic yellow */
    --white:#ffffff;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:#e8eefb; background:#061227; overflow-x:hidden;
    font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  }

  /* --- Background gradient + particles layer --- */
  .bg{
    position:fixed; inset:0; z-index:-2;
    background:
      radial-gradient(900px 600px at 15% 15%, rgba(255,255,255,.05), transparent 60%),
      radial-gradient(900px 600px at 85% 75%, rgba(255,255,255,.04), transparent 60%),
      linear-gradient(135deg, #0a3952 0%, #0b2d68 35%, #082145 65%, #041933 100%);
  }
  .bg::after{ /* turquoise wash */
    content:""; position:absolute; inset:0; z-index:-1;
    background: radial-gradient(800px 480px at 75% 25%, rgba(18,212,207,.18), transparent 60%);
    mix-blend-mode:screen; pointer-events:none;
  }
  canvas#particles{
    position:fixed; inset:0; z-index:-1; pointer-events:none;
    filter: drop-shadow(0 0 2px rgba(18,212,207,.25));
  }

  /* --- Layout --- */
  .wrap{max-width:1100px; margin:0 auto; padding:32px 16px 80px;}
  header{
    display:flex; align-items:center; gap:12px; padding:10px 0 18px; opacity:.98;
  }
  .logo{
    width:36px; height:36px; border-radius:10px;
    background: conic-gradient(from 210deg, #c9d5e9, #8ea2bf, #c9d5e9);
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.15), 0 6px 18px rgba(0,0,0,.35);
    display:grid; place-items:center; position:relative;
  }
  .logo::after{
    content:""; width:18px; height:18px; border-radius:4px;
    background: linear-gradient(145deg, var(--accent), #ffe98a);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
  }
  .brand{
    font-weight:800; letter-spacing:.4px; font-size:22px;
    background: linear-gradient(90deg, #fff, #cfe8ff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }

  /* --- Hero with parallax --- */
  .hero{
    position:relative; margin-top:8px; margin-bottom:26px; perspective:1000px;
  }
  .hero-inner{
    transform-style:preserve-3d; transition: transform .25s ease, filter .25s ease;
    will-change:transform;
  }
  h1{
    margin:6px 0 6px; font-size:56px; line-height:1.05; letter-spacing:.2px;
    background: linear-gradient(90deg, #eaf3ff 0%, #bfe9ff 60%, #eaf3ff 100%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow: 0 6px 24px rgba(4,185,255,.08);
  }
  .sub{
    color:#cfe0ff; max-width:720px; font-size:18px; opacity:.9;
  }

  /* --- Card --- */
  .card{
    background: linear-gradient(180deg, var(--panel), var(--panel-2));
    border:1px solid var(--edge);
    border-radius:20px; padding:22px; box-shadow:
      0 20px 50px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
  }

  textarea{
    width:100%; min-height:150px; resize:vertical;
    padding:14px 14px 16px; border-radius:14px; border:1px solid #253550;
    background:#0a1427; color:#e8eefb; font-size:18px; line-height:1.55;
    font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
  }

  .row{display:flex; gap:12px; flex-wrap:wrap; margin-top:14px}
  button{
    appearance:none; border:0; cursor:pointer; border-radius:14px; padding:13px 18px;
    font-weight:800; letter-spacing:.3px;
  }
  .btn-primary{
    color:#1a1a1a; background:linear-gradient(180deg, #ffe98a, var(--accent));
    box-shadow:0 12px 26px rgba(255,216,77,.25), inset 0 0 0 1px rgba(0,0,0,.15);
  }
  .btn-ghost{
    color:#e8eefb; background:transparent; border:1px solid #2b3b5a;
  }
  .btn-danger{background:#ef4444; color:#fff}

  .status{margin-top:12px; font-weight:700}
  .status.ok{color:#a7f3d0}
  .status.err{color:#fecaca}
  .progress{
    width:100%; height:10px; background:#0a1323; border-radius:999px; overflow:hidden; margin:12px 0;
    border:1px solid #213556;
  }
  .bar{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),#ffe98a); transition:width .3s ease}

  iframe{
    width:100%; height:60vh; border:0; border-radius:18px; background:#fff;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
  }

  /* --- Editor overlay (unchanged flow) --- */
  .overlay{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999;
    background:rgba(3,10,20,.7); padding:18px;}
  .sheet{width:min(100%,980px); background:#0b1426; border:1px solid #243450; border-radius:16px; padding:16px}
  .sheet textarea{min-height:62vh}
  .sheet .row{justify-content:flex-end}

  /* Responsive */
  @media (max-width:640px){
    h1{font-size:42px}
    .sub{font-size:16px}
  }
</style>
</head>
<body>
  <!-- gradient + particles -->
  <div class="bg"></div>
  <canvas id="particles" aria-hidden="true"></canvas>

  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div class="brand">SiteCraftAI</div>
    </header>

    <section class="hero" id="hero">
      <div class="hero-inner" id="heroInner">
        <h1>Build websites with AI, then launch them live.</h1>
        <p class="sub">Describe your website. We’ll generate a complete page in about a minute.
          Preview it here, make quick edits, and publish to Vercel in one click.</p>
      </div>
    </section>

    <section class="card">
      <label for="prompt" style="display:block;margin:0 0 8px;font-weight:700;color:#cfe0ff">Your brief</label>
      <textarea id="prompt" placeholder="Describe your website...">A modern coffee shop website for Brew Haven Café, with a warm color palette, hero image of latte art, three featured sections for Menu, About Us, and Contact, plus a footer with opening hours.</textarea>

      <div class="row">
        <button id="genBtn" class="btn-primary">Generate my website</button>
        <button id="editBtn" class="btn-ghost">Edit HTML</button>
        <button id="publishBtn" class="btn-ghost">Publish Live</button>
        <a id="downloadBtn" class="btn-ghost" download="sitecraft.html" href="javascript:void(0)">Download HTML</a>
      </div>

      <div class="progress"><div class="bar" id="bar"></div></div>
      <div id="status" class="status"></div>

      <h3 style="margin:18px 0 10px">Preview</h3>
      <iframe id="preview" title="Generated website preview"></iframe>
    </section>
  </div>

  <!-- Editor overlay -->
  <div class="overlay" id="editorOverlay" role="dialog" aria-modal="true" aria-label="HTML editor">
    <div class="sheet">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px">
        <strong>Edit HTML</strong>
        <span class="badge">Quick tweak → Update preview</span>
      </div>
      <textarea id="editor"></textarea>
      <div class="row" style="margin-top:10px">
        <button id="cancelEdit" class="btn-ghost">Close</button>
        <button id="applyEdit" class="btn-primary">Update Preview</button>
      </div>
    </div>
  </div>

<script>
  // ========= CONFIG =========
  // Set your backend base URL here if needed.
  // If omitted, it defaults to your Render backend we used earlier.
  const API_BASE = window.BACKEND_URL || 'https://sitecraft-backend.onrender.com';

  const els = {
    prompt: document.getElementById('prompt'),
    genBtn: document.getElementById('genBtn'),
    publishBtn: document.getElementById('publishBtn'),
    editBtn: document.getElementById('editBtn'),
    downloadBtn: document.getElementById('downloadBtn'),
    preview: document.getElementById('preview'),
    status: document.getElementById('status'),
    bar: document.getElementById('bar'),
    overlay: document.getElementById('editorOverlay'),
    editor: document.getElementById('editor'),
    applyEdit: document.getElementById('applyEdit'),
    cancelEdit: document.getElementById('cancelEdit'),
    heroInner: document.getElementById('heroInner')
  };

  let latestHTML = '';

  function setStatus(msg, type=''){
    els.status.textContent = msg || '';
    els.status.className = 'status ' + (type || '');
  }
  function setProgress(p){ els.bar.style.width = Math.max(0, Math.min(100, p)) + '%'; }

  // ===== Generate =====
  async function generateSite(){
    try{
      setStatus('Generating… this can take ~30–60s.');
      setProgress(18);

      const res = await fetch(`${API_BASE}/generate`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ prompt: els.prompt.value })
      });

      setProgress(55);

      if(!res.ok){
        const txt = await res.text().catch(()=> '');
        throw new Error(`Server error ${res.status}: ${txt || res.statusText}`);
      }
      const data = await res.json();
      if(!data || !data.html) throw new Error('No HTML returned from generator.');

      latestHTML = data.html;
      updatePreview(latestHTML);
      setProgress(100);
      setStatus('Done. Preview updated.', 'ok');
      enableDownload(latestHTML);
    }catch(err){
      console.error(err);
      setStatus(err.message || 'Failed to generate.', 'err');
      setProgress(0);
    }
  }

  function updatePreview(html){
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    els.preview.src = url;
  }

  function enableDownload(html){
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    els.downloadBtn.href = url;
  }

  // ===== Editor =====
  function openEditor(){
    if(!latestHTML){ setStatus('Generate a site first.', 'err'); return; }
    els.editor.value = latestHTML;
    els.overlay.style.display = 'flex';
  }
  function closeEditor(){ els.overlay.style.display='none'; }
  function applyEdit(){
    latestHTML = els.editor.value;
    updatePreview(latestHTML);
    enableDownload(latestHTML);
    setStatus('Preview updated from editor.', 'ok');
    closeEditor();
  }

  // ===== Publish =====
  async function publishSite(){
    if(!latestHTML){ setStatus('Generate a site first.', 'err'); return; }
    try{
      setStatus('Publishing to Vercel…'); setProgress(35);
      const res = await fetch(`${API_BASE}/publish`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ html: latestHTML })
      });
      setProgress(75);

      if(!res.ok){
        const txt = await res.text().catch(()=> '');
        throw new Error(`Server error ${res.status}: ${txt || res.statusText}`);
      }
      const data = await res.json();
      // Expected shape: { url: "https://your-live-url.vercel.app" }
      if(data && data.url){
        setProgress(100);
        setStatus(`Live! ${data.url}`, 'ok');
        // Optional: open new tab
        window.open(data.url, '_blank','noopener');
      }else{
        setProgress(0);
        setStatus('Published, but no URL returned.', 'err');
      }
    }catch(err){
      console.error(err);
      setStatus(err.message || 'Failed to publish.', 'err');
      setProgress(0);
    }
  }

  // ===== Parallax (mouse + mobile tilt) =====
  (function parallax(){
    const el = els.heroInner;
    let px=0, py=0;
    function render(){
      el.style.transform = `rotateX(${py*4}deg) rotateY(${px*6}deg) translateZ(0)`;
      requestAnimationFrame(render);
    }
    render();

    function onMove(e){
      const { innerWidth:w, innerHeight:h } = window;
      const cx = (e.clientX ?? (w/2));
      const cy = (e.clientY ?? (h/2));
      px = (cx/w - .5); py = - (cy/h - .5);
    }
    window.addEventListener('mousemove', onMove, {passive:true});

    // Mobile tilt
    window.addEventListener('deviceorientation', (e)=>{
      if(e.beta == null || e.gamma == null) return;
      const nx = Math.max(-30, Math.min(30, e.gamma))/30;
      const ny = Math.max(-30, Math.min(30, e.beta-30))/30;
      px = nx * 0.6; py = -ny * 0.6;
    }, {passive:true});
  })();

  // ===== Particles Canvas =====
  (function particles(){
    const c = document.getElementById('particles');
    const ctx = c.getContext('2d');
    let w=0,h=0, dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    let dots = [];
    const DOTS = Math.min(180, Math.floor((window.innerWidth*window.innerHeight)/12000));

    function resize(){
      w = c.width = Math.floor(innerWidth * dpr);
      h = c.height = Math.floor(innerHeight * dpr);
      c.style.width = innerWidth+'px';
      c.style.height = innerHeight+'px';
      dots = Array.from({length:DOTS}, ()=>({
        x: Math.random()*w, y: Math.random()*h,
        vx: (Math.random()*1.2-0.6)*dpr,
        vy: (Math.random()*1.2-0.6)*dpr,
        r: (Math.random()*1.8+0.8)*dpr,
        a: Math.random()*0.7 + 0.15
      }));
    }
    function step(){
      ctx.clearRect(0,0,w,h);
      ctx.globalCompositeOperation='lighter';
      for(const p of dots){
        p.x += p.vx; p.y += p.vy;
        if(p.x<0||p.x>w) p.vx*=-1;
        if(p.y<0||p.y>h) p.vy*=-1;

        // glow dot
        ctx.beginPath();
        ctx.fillStyle = `rgba(18,212,207,${p.a})`;
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();
      }
      // light connections
      ctx.lineWidth = 0.6*dpr;
      for(let i=0;i<dots.length;i++){
        for(let j=i+1;j<dots.length;j++){
          const dx = dots[i].x - dots[j].x;
          const dy = dots[i].y - dots[j].y;
          const dist = Math.hypot(dx,dy);
          if(dist < 120*dpr){
            const alpha = 1 - (dist/(120*dpr));
            ctx.strokeStyle = `rgba(14,165,233,${alpha*.25})`;
            ctx.beginPath();
            ctx.moveTo(dots[i].x, dots[i].y);
            ctx.lineTo(dots[j].x, dots[j].y);
            ctx.stroke();
          }
        }
      }
      requestAnimationFrame(step);
    }
    resize();
    step();
    window.addEventListener('resize', resize);
  })();

  // ===== Wire up =====
  els.genBtn.addEventListener('click', generateSite);
  els.publishBtn.addEventListener('click', publishSite);
  els.editBtn.addEventListener('click', openEditor);
  els.applyEdit.addEventListener('click', applyEdit);
  els.cancelEdit.addEventListener('click', closeEditor);
</script>
</body>
</html>
