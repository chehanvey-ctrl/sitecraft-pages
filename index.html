<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SiteCraftAI â€” Build websites with AI, then launch them live</title>
  <meta name="description" content="Describe your website. Weâ€™ll generate a complete page in ~60 seconds. Preview it here, make quick edits, and publish to Vercel in one click." />

  <style>
    :root{
      --ink:#0b1324; --ink-2:#dbe7ff; --muted:#92a7c6;
      --panel:#0f172a; --panel-2:#0a1226; --accent:#ffe164; --accent-2:#ffed9a;
      --btn:#ffd84d; --btn-ink:#2b2b00;
      --ring:rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:#e9f1ff; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
      background: radial-gradient(1200px 900px at 20% 10%, rgba(255,255,255,.08), transparent 60%),
                  radial-gradient(1000px 800px at 80% 0%, rgba(255,255,255,.06), transparent 60%),
                  linear-gradient(160deg, #0a3d5a 0%, #09223f 55%, #081a31 100%);
      overflow-x:hidden;
    }

    /* Floating particle field (parallax-ish) */
    .particles, .particles:before, .particles:after{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      background-image:
        radial-gradient(2px 2px at 10% 15%, rgba(255,255,255,.8) 50%, transparent 52%),
        radial-gradient(2px 2px at 30% 35%, rgba(173,216,230,.9) 50%, transparent 52%),
        radial-gradient(2px 2px at 55% 22%, rgba(255,255,255,.7) 50%, transparent 52%),
        radial-gradient(2px 2px at 78% 18%, rgba(173,216,230,.85) 50%, transparent 52%),
        radial-gradient(2px 2px at 88% 40%, rgba(255,255,255,.7) 50%, transparent 52%),
        radial-gradient(2px 2px at 62% 70%, rgba(173,216,230,.8) 50%, transparent 52%),
        radial-gradient(2px 2px at 25% 75%, rgba(255,255,255,.75) 50%, transparent 52%),
        radial-gradient(2px 2px at 12% 58%, rgba(173,216,230,.85) 50%, transparent 52%);
      animation: drift 38s linear infinite;
      opacity:.45;
      filter: drop-shadow(0 0 6px rgba(120,220,255,.25));
    }
    .particles:before{content:""; animation-duration:55s; opacity:.35; transform:translateZ(0)}
    .particles:after{content:""; animation-duration:72s; opacity:.28; transform:translateZ(0)}
    @keyframes drift{
      0%{transform:translate3d(0,0,0)}
      50%{transform:translate3d(-2%, -3%, 0)}
      100%{transform:translate3d(0,0,0)}
    }

    .wrap{position:relative; z-index:1; max-width:1040px; margin:0 auto; padding:28px 18px 96px;}

    /* Brand row */
    .brand{display:flex; align-items:center; gap:12px; margin:4px 0 18px;}
    .logo{
      width:36px; height:36px; border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, #fff 0 35%, #ffd94e 36% 62%, #ffefb0 63% 67%, transparent 68% 100%),
        linear-gradient(135deg, #ffe478, #9b8e16);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25), 0 4px 22px rgba(255,230,120,.25);
      position:relative;
    }
    .logo:after{
      content:""; position:absolute; inset:0; border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.25), rgba(255,255,255,0) 40%, rgba(0,0,0,.25));
      mix-blend-mode:overlay;
    }
    .brand h1{margin:0; font-size:26px; letter-spacing:.2px}
    .brand .hl{color:#fff; font-weight:800}
    .brand .muted{color:#cfe3ff; font-weight:700}

    /* Hero */
    .hero h2{
      font-size: clamp(32px, 6vw, 64px);
      line-height:1.05; margin:8px 0 12px; letter-spacing:.2px;
    }
    .hero p{color:var(--ink-2); max-width:820px; margin:0 0 26px; font-size:18px}

    /* Card */
    .card{
      background: radial-gradient(800px 400px at 15% 0%, rgba(255,255,255,.05), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid var(--ring);
      border-radius:22px; padding:20px; box-shadow:0 24px 60px rgba(0,0,0,.35);
    }
    label{display:block; color:#cddaf6; font-weight:700; margin:2px 0 10px}
    textarea{
      width:100%; min-height:170px; resize:vertical; border-radius:16px; border:1px solid rgba(255,255,255,.12);
      background:#0a1324; color:#e9f1ff; padding:16px; font-size:18px; line-height:1.5;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .row{display:flex; gap:12px; flex-wrap:wrap; margin-top:14px}
    button{
      appearance:none; border:0; border-radius:16px; padding:14px 18px; font-weight:800; cursor:pointer;
      box-shadow:0 10px 28px rgba(0,0,0,.35);
    }
    .primary{background:var(--btn); color:var(--btn-ink)}
    .ghost{background:#0c152a; color:#e8f2ff; border:1px solid var(--ring)}
    .linky{background:transparent; color:#cfe3ff; text-decoration:underline; padding:14px 4px}
    .danger{background:#ef4444; color:#fff}

    .status{margin-top:12px; font-weight:700; color:#ffb4b4; min-height:24px}

    .preview{margin-top:16px; border-radius:20px; overflow:hidden; border:1px solid var(--ring); background:#fff}
    iframe{width:100%; height:62vh; border:0; display:block}

    /* Editor overlay */
    .overlay{position:fixed; inset:0; background:rgba(4,10,23,.75); display:none; align-items:center; justify-content:center; padding:16px; z-index:9999}
    .sheet{width:min(100%, 1020px); background:#0b142a; border:1px solid var(--ring); color:#e9f1ff; border-radius:18px; padding:18px; box-shadow:0 24px 70px rgba(0,0,0,.6)}
    .sheet h3{margin:4px 0 12px}
    .sheet textarea{min-height:62vh}
    .sheet .row{justify-content:flex-end}
  </style>
</head>

<body>
  <div class="particles"></div>

  <div class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1><span class="muted">Site</span><span class="hl">CraftAI</span></h1>
    </div>

    <section class="hero">
      <h2>Build websites with AI, then launch them live.</h2>
      <p>Describe your website. Weâ€™ll generate a complete page in about a minute. Preview it here, make quick edits, and publish to Vercel in one click.</p>
    </section>

    <section class="card">
      <label for="prompt">Your brief</label>
      <textarea id="prompt" spellcheck="true" placeholder="Describe your website...">A modern coffee shop website for Brew Haven CafÃ©, with a warm color palette, hero image of latte art, three featured sections for Menu, About Us, and Contact, plus a footer with opening hours.</textarea>

      <div class="row">
        <button id="genBtn" class="primary">Generate my website</button>
        <button id="editBtn" class="ghost">Edit HTML</button>
        <button id="publishBtn" class="ghost">Publish Live</button>
        <button id="downloadBtn" class="linky">Download HTML</button>
      </div>

      <div id="status" class="status"></div>

      <div class="preview">
        <iframe id="preview" title="Generated website preview"></iframe>
      </div>
    </section>
  </div>

  <!-- Editor overlay -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="edTitle">
    <div class="sheet">
      <h3 id="edTitle">Quick Edit</h3>
      <textarea id="editor"></textarea>
      <div class="row">
        <button id="closeEd" class="ghost">Cancel</button>
        <button id="applyEd" class="primary">Apply to Preview</button>
      </div>
    </div>
  </div>

  <script>
    // ================= CONFIG =================
    // Your Render backend base URL
    const API_BASE = 'https://sitecraft-backend.onrender.com';
    // Endpoints that match FastAPI (confirmed in your Swagger)
    const GENERATE_URL = `${API_BASE}/generate-html`;
    const PUBLISH_URL  = `${API_BASE}/publish-html`;

    // Warm-up ping (Render free instances can sleep)
    fetch(`${API_BASE}/`, { method: 'GET' }).catch(()=>{});

    // ================= DOM =================
    const el = (id)=>document.getElementById(id);
    const promptEl = el('prompt');
    const statusEl = el('status');
    const iframeEl = el('preview');

    const overlay = el('overlay');
    const editor  = el('editor');
    el('genBtn').onclick = onGenerate;
    el('publishBtn').onclick = onPublish;
    el('downloadBtn').onclick = onDownload;
    el('editBtn').onclick = openEditor;
    el('applyEd').onclick = applyEditor;
    el('closeEd').onclick = () => overlay.style.display = 'none';

    // Keep last HTML for editing/publishing
    let currentHTML = '';

    function setStatus(msg, isError=false){
      statusEl.textContent = msg || '';
      statusEl.style.color = isError ? '#ffb4b4' : '#a7f3d0';
    }

    function loadPreview(html){
      currentHTML = html || '';
      const doc = iframeEl.contentWindow.document;
      doc.open();
      doc.write(html || '');
      doc.close();
      localStorage.setItem('sitecraft_last_html', currentHTML);
    }

    // Restore last session if available
    (function restore(){
      const last = localStorage.getItem('sitecraft_last_html');
      if(last){ loadPreview(last); }
    })();

    async function onGenerate(){
      const prompt = (promptEl.value || '').trim();
      if(!prompt){ setStatus('Please write a short brief first.', true); return; }

      setStatus('Generating your siteâ€¦ this can take ~40â€“60 seconds â³');
      try{
        const res = await fetch(GENERATE_URL, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ prompt })
        });

        if(!res.ok){
          const txt = await res.text().catch(()=> '');
          throw new Error(`Server error ${res.status}: ${txt || res.statusText}`);
        }
        const data = await res.json();
        if(!data || !data.html){ throw new Error('No HTML returned from generator'); }

        loadPreview(data.html);
        setStatus('Done! Preview updated âœ…');
      }catch(err){
        console.error(err);
        setStatus(err.message || 'Failed to generate.', true);
      }
    }

    function openEditor(){
      if(!currentHTML){ setStatus('Generate a page first, then edit.', true); return; }
      editor.value = currentHTML;
      overlay.style.display = 'flex';
    }

    function applyEditor(){
      loadPreview(editor.value);
      overlay.style.display = 'none';
      setStatus('Edits applied to preview âœ¨');
    }

    async function onPublish(){
      if(!currentHTML){ setStatus('Nothing to publish yet â€” generate first.', true); return; }
      setStatus('Publishing to Vercelâ€¦');

      // simple slug from time (youâ€™ll swap for user auth later)
      const slug = `site-${Date.now()}`;

      try{
        const res = await fetch(PUBLISH_URL, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ html: currentHTML, slug })
        });

        if(!res.ok){
          const txt = await res.text().catch(()=> '');
          throw new Error(`Server error ${res.status}: ${txt || res.statusText}`);
        }
        const data = await res.json();
        if(data?.url){
          setStatus(`Published ðŸŽ‰  ${data.url}`);
        }else{
          setStatus('Published, but no URL returned.', true);
        }
      }catch(err){
        console.error(err);
        setStatus(err.message || 'Publish failed.', true);
      }
    }

    function onDownload(){
      if(!currentHTML){ setStatus('Generate something first to download.', true); return; }
      const blob = new Blob([currentHTML], {type:'text/html'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'sitecraft-page.html';
      document.body.appendChild(a);
      a.click();
      a.remove();
      setStatus('HTML downloaded.');
    }
  </script>
</body>
</html>
